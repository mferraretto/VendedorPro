<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MENTORIA FERRARETTO</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .tabs button { padding: 10px 20px; border: none; background: #e2e8f0; cursor: pointer; transition: all 0.3s; border-radius: 6px; }
    .tabs button:hover { background: #cbd5e0; }
    .tabs button.active { background: #4CAF50; color: white; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .grid-cols-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .card { background: #f8fafc; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: transform 0.3s; }
    .card:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
    input { width: 100%; padding: 10px; margin-bottom: 12px; border: 1px solid #cbd5e0; border-radius: 8px; background: #fff; }
    input:focus { outline: none; border-color: #4CAF50; box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2); }
    button.calc-btn { background-color: #4CAF50; color: white; padding: 10px 16px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: background 0.3s; }
    button.calc-btn:hover { background-color: #3d8b40; }
    .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
    .modal-content { background-color: #fff; margin: 5% auto; padding: 25px; border-radius: 12px; width: 90%; max-width: 700px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
    .btn-action { padding: 8px 12px; border-radius: 6px; cursor: pointer; margin-left: 5px; border: none; font-weight: 500; transition: all 0.2s; }
    .btn-action i { margin-right: 5px; }
    .btn-edit { background-color: #FFC107; color: #333; }
    .btn-edit:hover { background-color: #e0a800; }
    .btn-delete { background-color: #F44336; color: white; }
    .btn-delete:hover { background-color: #d32f2f; }
    .btn-view { background-color: #2196F3; color: white; }
    .btn-view:hover { background-color: #0b7dda; }
    .btn-close { float: right; font-size: 24px; font-weight: bold; cursor: pointer; color: #777; }
    .btn-close:hover { color: #333; }
    .product-card { background: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.08); padding: 20px; transition: all 0.3s; }
    .product-card:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.12); }
    .platform-tag { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .platform-ml { background: #ffe0e0; color: #c62828; }
    .platform-shopee { background: #e3f2fd; color: #1565c0; }
    .platform-magalu { background: #e8f5e9; color: #2e7d32; }
    .platform-shein { background: #f3e5f5; color: #6a1b9a; }
    .product-price { font-size: 1.5rem; font-weight: 700; }
    .header { background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; padding: 20px; border-radius: 0 0 20px 20px; margin-bottom: 30px; }
    .input-group { margin-bottom: 15px; }
    .input-group label { display: block; margin-bottom: 6px; font-weight: 500; color: #334155; }
    .scenario-card { background: white; border-radius: 8px; padding: 15px; margin-top: 10px; border-left: 4px solid; }
    .scenario-ideal { border-left-color: #4CAF50; background-color: #f0fdf4; }
    .scenario-medium { border-left-color: #FFC107; background-color: #fffbeb; }
    .scenario-promo { border-left-color: #F44336; background-color: #fef2f2; }
    .scenario-title { font-weight: 600; margin-bottom: 5px; }
    .scenario-value { font-size: 1.2rem; font-weight: 700; }
    .import-export-section { background: #f0fdf4; border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #d1fae5; }
    .price-update-options { display: flex; gap: 10px; margin-top: 15px; }
    .price-update-options button { padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: 500; border: none; }
    .btn-apply-promo { background-color: #F44336; color: white; }
    .btn-apply-medium { background-color: #FFC107; color: #333; }
    .btn-apply-ideal { background-color: #4CAF50; color: white; }
    .btn-export-shopee { background-color: #2196F3; color: white; }
    .imported-products-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .imported-products-table th, .imported-products-table td { border: 1px solid #e2e8f0; padding: 8px; text-align: left; }
    .imported-products-table th { background-color: #f8fafc; font-weight: 600; }
    .imported-products-table tr:nth-child(even) { background-color: #f8fafc; }
    .dashboard-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    .profile-badge { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; margin-left: 8px; }
    .admin-badge { background: #ffebee; color: #c62828; }
    .operator-badge { background: #e3f2fd; color: #1565c0; }
    .viewer-badge { background: #e8f5e9; color: #2e7d32; }
    .history-item { border-left: 3px solid #4CAF50; padding-left: 10px; margin-bottom: 8px; }
    .api-status { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 5px; }
    .api-connected { background: #4CAF50; }
    .api-disconnected { background: #F44336; }
    @media (max-width: 768px) {
      .grid-cols-2 { grid-template-columns: 1fr; }
      .modal-content { width: 95%; margin: 10px auto; }
      .price-update-options { flex-wrap: wrap; }
      .tabs { gap: 5px; }
      .tabs button { padding: 8px 12px; font-size: 14px; }
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- Barra de navegação superior -->
  <div class="bg-gray-800 text-white p-4 flex justify-between items-center">
    <div class="flex items-center">
      <i class="fas fa-calculator text-2xl mr-3"></i>
      <h1 class="text-xl font-bold">MENTORIA FERRARETTO</h1>
    </div>
    <div id="userArea" class="flex items-center">
      <span id="currentUser" class="mr-4 hidden"></span>
      <button id="loginBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
        <i class="fas fa-sign-in-alt mr-2"></i> Login
      </button>
      <button id="logoutBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg hidden">
        <i class="fas fa-sign-out-alt mr-2"></i> Sair
      </button>
    </div>
  </div>
  <nav class="bg-gray-700 text-white p-4 flex flex-wrap justify-center space-x-4 mb-6 rounded">
    <a href="index.html" class="hover:underline">Início</a>
    <a href="#" class="hover:underline font-bold">Precificação</a>
    <a href="#" class="hover:underline">Anúncios</a>
    <a href="#" class="hover:underline">Sobras</a>
    <a href="#" class="hover:underline">Custeio</a>
  </nav>
  <div class="container mx-auto p-4">
    <!-- Abas principais -->
    <div class="tabs">
      <button class="tab-button active" data-tab="dashboard">
        <i class="fas fa-tachometer-alt"></i> Dashboard
      </button>
      <button class="tab-button" data-tab="precificacao">
        <i class="fas fa-calculator"></i> Precificação
      </button>
      <button class="tab-button" data-tab="produtos">
        <i class="fas fa-box"></i> Produtos
      </button>
      <button class="tab-button" data-tab="historico" id="historyTab">
        <i class="fas fa-history"></i> Histórico
      </button>
      <button class="tab-button" data-tab="configuracoes" id="configTab">
        <i class="fas fa-cog"></i> Configurações
      </button>
    </div>

    <!-- Conteúdo das abas -->
    <div id="dashboard" class="tab-content active">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="dashboard-card">
          <h3 class="text-gray-500 text-sm">Produtos Cadastrados</h3>
          <p id="totalProducts" class="text-2xl font-bold">12</p>
        </div>
        <div class="dashboard-card">
          <h3 class="text-gray-500 text-sm">Margem Média</h3>
          <p id="avgMargin" class="text-2xl font-bold">18.5%</p>
        </div>
        <div class="dashboard-card">
          <h3 class="text-gray-500 text-sm">Conexões Ativas</h3>
          <p id="activeConnections" class="text-2xl font-bold">2/3</p>
        </div>
        <div class="dashboard-card">
          <h3 class="text-gray-500 text-sm">Última Atualização</h3>
          <p id="lastUpdate" class="text-2xl font-bold">Hoje, 14:30</p>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div class="dashboard-card">
          <h3 class="font-bold text-lg mb-4">Margem por Plataforma</h3>
          <canvas id="marginChart" height="200"></canvas>
        </div>
        <div class="dashboard-card">
          <h3 class="font-bold text-lg mb-4">Produtos Mais Rentáveis</h3>
          <canvas id="topProductsChart" height="200"></canvas>
        </div>
        <div class="dashboard-card">
          <h3 class="font-bold text-lg mb-4">Status de Conexão</h3>
          <div class="space-y-3">
            <div class="flex items-center">
              <span class="api-status api-connected"></span>
              <span>Mercado Livre: <span class="font-semibold">Conectado</span></span>
            </div>
            <div class="flex items-center">
              <span class="api-status api-connected"></span>
              <span>Shopee: <span class="font-semibold">Conectado</span></span>
            </div>
            <div class="flex items-center">
              <span class="api-status api-disconnected"></span>
              <span>Magalu: <span class="font-semibold">Desconectado</span></span>
            </div>
          </div>
          <div class="mt-6">
            <h4 class="font-semibold mb-2">Últimas Atualizações</h4>
            <div id="recentUpdates" class="space-y-2">
              <div>Produto "Tênis Esportivo" atualizado</div>
              <div class="text-xs text-gray-500">14:25</div>
              <div>Usuário admin fez login</div>
              <div class="text-xs text-gray-500">14:20</div>
              <div>Preços recalculados para Shopee</div>
              <div class="text-xs text-gray-500">14:15</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="dashboard-card mb-6">
        <h3 class="font-bold text-lg mb-4">Histórico de Preços</h3>
        <canvas id="priceHistoryChart" height="300"></canvas>
      </div>
    </div>

    <div id="precificacao" class="tab-content">
      <div class="bg-white rounded-xl p-6 shadow mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="input-group">
            <label for="produto">Nome do Produto</label>
            <input id="produto" placeholder="Ex: Tênis Esportivo" class="p-3 border rounded-lg" value="Tênis Esportivo">
          </div>
          <div class="input-group">
            <label for="sku">Código SKU</label>
            <input id="sku" placeholder="Ex: TN-ESPORT-001" class="p-3 border rounded-lg" value="TN-ESPORT-001">
          </div>
          <div class="input-group">
            <label for="custo">Custo do Produto (R$)</label>
            <input id="custo" placeholder="Ex: 89,90" type="number" step="0.01" class="p-3 border rounded-lg" value="89.90">
          </div>
        </div>
      </div>

      <div class="grid-cols-2 mt-4">
        <!-- Mercado Livre -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4 text-red-600"><i class="fas fa-store"></i> Mercado Livre</h2>
          <div id="mlCampos">
            <div class="input-group">
              <label>Taxas da Plataforma (%)</label>
              <div class="flex gap-2">
                <select id="ml_taxa_select" class="flex-1 p-2 border rounded-lg">
                  <option value="16">16%</option>
                  <option value="21" selected>21%</option>
                </select>
                <input type="number" step="0.01" placeholder="Outro" id="ml_taxa_custom" class="flex-1 p-2 border rounded-lg">
              </div>
            </div>
            
            <div class="input-group">
              <label>Custo Fixo Plataforma (R$)</label>
              <div class="flex gap-2">
                <select id="ml_fixo_select" class="flex-1 p-2 border rounded-lg">
                  <option value="6" selected>R$ 6,00</option>
                </select>
                <input type="number" step="0.01" placeholder="Outro" id="ml_fixo_custom" class="flex-1 p-2 border rounded-lg">
              </div>
            </div>
            
            <input placeholder="Frete (R$)" data-campo="Frete (R$)" class="p-2" value="15.00">
            <input placeholder="Taxa de Transação (%)" data-campo="Taxa de Transação (%)" class="p-2" value="4.0">
            <input placeholder="Taxa de Transferência (%)" data-campo="Taxa de Transferência (%)" class="p-2" value="1.5">
            <input placeholder="Taxa de Antecipação (%)" data-campo="Taxa de Antecipação (%)" class="p-2" value="2.0">
            <input placeholder="Custos Variáveis (R$)" data-campo="Custos Variáveis (R$)" class="p-2" value="5.00">
            <input placeholder="Imposto (%)" data-campo="Imposto (%)" class="p-2" value="12.0">
            <input placeholder="Comissão do Vendedor (%)" data-campo="Comissão do Vendedor (%)" class="p-2" value="3.0">
            
            <div class="input-group mt-4">
              <label>Preço Mínimo (R$)</label>
              <input id="preco_ml" disabled class="p-3 bg-gray-100 font-bold text-lg" value="189.90">
            </div>
            
             <div class="scenario-card scenario-promo">
              <div class="scenario-title">Sem Lucro (0%)</div>
              <div class="scenario-value" id="preco_ml_promo">R$ 189.90</div>
            </div>
            
            <div class="scenario-card scenario-medium">
              <div class="scenario-title">Lucro 5%</div>
              <div class="scenario-value" id="preco_ml_medio">R$ 199.40</div>
            </div>
            
            <div class="scenario-card scenario-ideal">
              <div class="scenario-title">Lucro 10%</div>
              <div class="scenario-value" id="preco_ml_ideal">R$ 208.90</div>
            </div>
          </div>
          <button class="calc-btn w-full mt-4" onclick="calcular('ml')">
            <i class="fas fa-save"></i> Calcular e Salvar
          </button>
        </div>

        <!-- Shopee -->
        <div class="card">
          <h2 class="text-xl font-bold mb-4 text-blue-600"><i class="fas fa-store"></i> Shopee</h2>
          <div id="shopeeCampos">
            <div class="input-group">
              <label>Taxas da Plataforma (%)</label>
              <div class="flex gap-2">
                <select id="shopee_taxa_select" class="flex-1 p-2 border rounded-lg">
                  <option value="14" selected>14%</option>
                  <option value="20">20%</option>
                </select>
                <input type="number" step="0.01" placeholder="Outro" id="shopee_taxa_custom" class="flex-1 p-2 border rounded-lg">
              </div>
            </div>
            
            <div class="input-group">
              <label>Custo Fixo Plataforma (R$)</label>
              <div class="flex gap-2">
                <select id="shopee_fixo_select" class="flex-1 p-2 border rounded-lg">
                  <option value="4" selected>R$ 4,00</option>
                </select>
                <input type="number" step="0.01" placeholder="Outro" id="shopee_fixo_custom" class="flex-1 p-2 border rounded-lg">
              </div>
            </div>
            
            <input placeholder="Frete (R$)" data-campo="Frete (R$)" class="p-2" value="12.00">
            <input placeholder="Taxa de Transação (%)" data-campo="Taxa de Transação (%)" class="p-2" value="3.5">
            <input placeholder="Taxa de Transferência (%)" data-campo="Taxa de Transferência (%)" class="p-2" value="1.0">
            <input placeholder="Taxa de Antecipação (%)" data-campo="Taxa de Antecipação (%)" class="p-2" value="1.5">
            <input placeholder="Custos Variáveis (R$)" data-campo="Custos Variáveis (R$)" class="p-2" value="4.00">
            <input placeholder="Imposto (%)" data-campo="Imposto (%)" class="p-2" value="10.0">
            <input placeholder="Comissão do Vendedor (%)" data-campo="Comissão do Vendedor (%)" class="p-2" value="2.5">
            
            <div class="input-group mt-4">
              <label>Preço Mínimo (R$)</label>
              <input id="preco_shopee" disabled class="p-3 bg-gray-100 font-bold text-lg" value="167.50">
            </div>
            
             <div class="scenario-card scenario-promo">
              <div class="scenario-title">Sem Lucro (0%)</div>
              <div class="scenario-value" id="preco_shopee_promo">R$ 167.50</div>
            </div>
            
            <div class="scenario-card scenario-medium">
              <div class="scenario-title">Lucro 5%</div>
              <div class="scenario-value" id="preco_shopee_medio">R$ 175.90</div>
            </div>
            
           <div class="scenario-card scenario-ideal">
              <div class="scenario-title">Lucro 10%</div>
              <div class="scenario-value" id="preco_shopee_ideal">R$ 184.25</div>
            </div>
          </div>
          <button class="calc-btn w-full mt-4" onclick="calcular('shopee')">
            <i class="fas fa-save"></i> Calcular e Salvar
          </button>
        </div>
      </div>
    </div>

    <div id="produtos" class="tab-content p-4">
      <div class="bg-white rounded-xl p-6 shadow mb-6">
        <h2 class="text-2xl font-bold mb-6"><i class="fas fa-boxes"></i> Produtos Salvos</h2>
        
        <div class="import-export-section">
          <h3 class="text-xl font-bold mb-4"><i class="fas fa-file-import"></i> Importar/Exportar Promoções Shopee</h3>
          
          <div class="flex flex-wrap gap-4">
            <div>
              <label class="block text-sm font-medium mb-2">Importar Planilha Shopee:</label>
              <input type="file" id="shopeeFileInput" accept=".xlsx,.xls" class="border p-2 rounded-lg">
            </div>
            <button onclick="importShopeeFile()" class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg font-medium h-10 mt-auto">
              <i class="fas fa-upload"></i> Importar
            </button>
          </div>
          
          <div id="importedShopeeProducts" class="mt-4">
            <h4 class="font-semibold mb-2">Produtos importados:</h4>
            <div class="overflow-x-auto">
              <table class="imported-products-table">
                <thead>
                  <tr>
                    <th>ID Produto</th>
                    <th>Nome</th>
                    <th>Parent SKU</th>
                    <th>ID Variação</th>
                    <th>Variação</th>
                    <th>SKU</th>
                    <th>Preço Original</th>
                    <th>Preço Desconto</th>
                  </tr>
                </thead>
                <tbody id="importedProductsTableBody">
                  <tr>
                    <td>P12345</td>
                    <td>Tênis Esportivo</td>
                    <td>TN-ESPORT</td>
                    <td>V001</td>
                    <td>Preto/40</td>
                    <td>TN-ESPORT-001</td>
                    <td>199.90</td>
                    <td class="font-bold">184.25</td>
                  </tr>
                  <tr>
                    <td>P12346</td>
                    <td>Camiseta Premium</td>
                    <td>CM-PREM</td>
                    <td>V002</td>
                    <td>Branco/M</td>
                    <td>CM-PREM-002</td>
                    <td>79.90</td>
                    <td class="font-bold">73.50</td>
                  </tr>
                  <tr>
                    <td>P12347</td>
                    <td>Calça Jeans</td>
                    <td>CL-JEANS</td>
                    <td>V003</td>
                    <td>Azul/38</td>
                    <td>CL-JEANS-003</td>
                    <td>129.90</td>
                    <td class="font-bold">119.50</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="price-update-options">
              <button onclick="applyPriceUpdate('promo')" class="btn-apply-promo">
                <i class="fas fa-tag"></i> Aplicar Sem Lucro (0%)
              </button>
              <button onclick="applyPriceUpdate('medium')" class="btn-apply-medium">
                <i class="fas fa-chart-line"></i> Aplicar Lucro 5%
              </button>
              <button onclick="applyPriceUpdate('ideal')" class="btn-apply-ideal">
                <i class="fas fa-star"></i> Aplicar Lucro 10%
              </button>
              <button onclick="exportShopeeFile()" class="btn-export-shopee ml-auto">
                <i class="fas fa-file-export"></i> Exportar Planilha
              </button>
            </div>
          </div>
        </div>
        
        <div class="flex flex-wrap gap-4 mb-6">
          <button onclick="exportarExcel()" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-3 rounded-lg font-medium">
            <i class="fas fa-file-excel"></i> Exportar Excel
          </button>
          <button onclick="exportarPDF()" class="bg-red-600 hover:bg-red-700 text-white px-5 py-3 rounded-lg font-medium">
            <i class="fas fa-file-pdf"></i> Exportar PDF
          </button>
        </div>
        
        <div class="mb-6">
          <label class="block text-sm font-medium mb-2">Filtrar por Plataforma:</label>
          <select id="filtroPlataforma" class="border p-3 rounded-lg w-full md:w-1/3">
            <option value="Todas">Todas as Plataformas</option>
            <option value="SHOPEE" selected>Shopee</option>
            <option value="MAGALU">Magalu</option>
            <option value="ML">Mercado Livre</option>
            <option value="SHEIN">SHEIN</option>
          </select>
        </div>
        
        <div id="listaProdutos" class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="product-card">
            <div class="flex justify-between items-start">
              <div>
                <h3 class="font-bold text-lg">Tênis Esportivo</h3>
                <div class="text-sm text-gray-500">SKU: TN-ESPORT-001</div>
                <div class="mt-1">
                  <span class="platform-shopee platform-tag">Shopee</span>
                </div>
              </div>
              <div class="text-right">
                <div class="text-gray-500 text-sm">Preço mínimo</div>
                <div class="product-price text-green-600">R$ 167.50</div>
              </div>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between">
              <div class="text-sm text-gray-500">
                <i class="far fa-calendar-alt"></i> 22/07/2025
              </div>
              <div class="flex space-x-2">
                <button onclick="verDetalhes()" class="btn-action btn-view">
                  <i class="fas fa-eye"></i> Ver
                </button>
                <button onclick="editarProduto()" class="btn-action btn-edit">
                  <i class="fas fa-edit"></i> Editar
                </button>
                <button class="btn-action btn-delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
          
          <div class="product-card">
            <div class="flex justify-between items-start">
              <div>
                <h3 class="font-bold text-lg">Camiseta Premium</h3>
                <div class="text-sm text-gray-500">SKU: CM-PREM-002</div>
                <div class="mt-1">
                  <span class="platform-ml platform-tag">Mercado Livre</span>
                </div>
              </div>
              <div class="text-right">
                <div class="text-gray-500 text-sm">Preço mínimo</div>
                <div class="product-price text-green-600">R$ 73.50</div>
              </div>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between">
              <div class="text-sm text-gray-500">
                <i class="far fa-calendar-alt"></i> 21/07/2025
              </div>
              <div class="flex space-x-2">
                <button onclick="verDetalhes()" class="btn-action btn-view">
                  <i class="fas fa-eye"></i> Ver
                </button>
                <button onclick="editarProduto()" class="btn-action btn-edit">
                  <i class="fas fa-edit"></i> Editar
                </button>
                <button class="btn-action btn-delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
          
          <div class="product-card">
            <div class="flex justify-between items-start">
              <div>
                <h3 class="font-bold text-lg">Calça Jeans</h3>
                <div class="text-sm text-gray-500">SKU: CL-JEANS-003</div>
                <div class="mt-1">
                  <span class="platform-shopee platform-tag">Shopee</span>
                </div>
              </div>
              <div class="text-right">
                <div class="text-gray-500 text-sm">Preço mínimo</div>
                <div class="product-price text-green-600">R$ 119.50</div>
              </div>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between">
              <div class="text-sm text-gray-500">
                <i class="far fa-calendar-alt"></i> 20/07/2025
              </div>
              <div class="flex space-x-2">
                <button onclick="verDetalhes()" class="btn-action btn-view">
                  <i class="fas fa-eye"></i> Ver
                </button>
                <button onclick="editarProduto()" class="btn-action btn-edit">
                  <i class="fas fa-edit"></i> Editar
                </button>
                <button class="btn-action btn-delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="historico" class="tab-content p-4">
      <div class="bg-white rounded-xl p-6 shadow">
        <h2 class="text-2xl font-bold mb-6"><i class="fas fa-history"></i> Histórico de Alterações</h2>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-2">Filtrar por:</label>
          <div class="flex flex-wrap gap-4">
            <select id="filterHistoryType" class="border p-2 rounded-lg">
              <option value="all">Todos os tipos</option>
              <option value="login">Logins</option>
              <option value="price_update">Atualizações de preço</option>
              <option value="product_edit">Edições de produto</option>
              <option value="backup">Backups</option>
            </select>
            <select id="filterHistoryUser" class="border p-2 rounded-lg">
              <option value="all">Todos os usuários</option>
              <option value="admin@empresa.com">admin@empresa.com</option>
              <option value="operador@empresa.com">operador@empresa.com</option>
            </select>
            <input type="date" id="filterHistoryDate" class="border p-2 rounded-lg" value="2025-07-22">
          </div>
        </div>
        
        <div id="historyList" class="space-y-4">
          <div class="history-item">
            <div class="flex justify-between">
              <div class="font-medium">Produto "Tênis Esportivo" atualizado</div>
              <div class="text-sm text-gray-500">22/07/2025 14:30</div>
            </div>
            <div class="text-sm text-gray-600">Usuário: admin@empresa.com</div>
          </div>
          <div class="history-item">
            <div class="flex justify-between">
              <div class="font-medium">Usuário admin@empresa.com fez login</div>
              <div class="text-sm text-gray-500">22/07/2025 14:20</div>
            </div>
            <div class="text-sm text-gray-600">Usuário: admin@empresa.com</div>
          </div>
          <div class="history-item">
            <div class="flex justify-between">
              <div class="font-medium">Preços recalculados para Shopee</div>
              <div class="text-sm text-gray-500">22/07/2025 14:15</div>
            </div>
            <div class="text-sm text-gray-600">Usuário: operador@empresa.com</div>
          </div>
          <div class="history-item">
            <div class="flex justify-between">
              <div class="font-medium">Produto "Camiseta Premium" cadastrado</div>
              <div class="text-sm text-gray-500">21/07/2025 10:45</div>
            </div>
            <div class="text-sm text-gray-600">Usuário: operador@empresa.com</div>
          </div>
        </div>
      </div>
    </div>

    <div id="configuracoes" class="tab-content p-4">
      <div class="bg-white rounded-xl p-6 shadow">
        <h2 class="text-2xl font-bold mb-6"><i class="fas fa-cog"></i> Configurações do Sistema</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="bg-gray-50 p-5 rounded-xl">
            <h3 class="font-semibold text-lg mb-4 pb-2 border-b">Configurações de API</h3>
            
            <div class="space-y-4">
              <div>
                <h4 class="font-medium mb-2">Mercado Livre</h4>
                <div class="space-y-3">
                  <div>
                    <label class="block text-sm font-medium mb-1">Client ID</label>
                    <input type="text" id="mlClientId" class="w-full p-2 border rounded" value="ml1234567890123456">
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-1">Client Secret</label>
                    <input type="password" id="mlClientSecret" class="w-full p-2 border rounded" value="****************">
                  </div>
                  <button onclick="testMlConnection()" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm">
                    Testar Conexão
                  </button>
                </div>
              </div>
              
              <div>
                <h4 class="font-medium mb-2">Shopee</h4>
                <div class="space-y-3">
                  <div>
                    <label class="block text-sm font-medium mb-1">API Key</label>
                    <input type="text" id="shopeeApiKey" class="w-full p-2 border rounded" value="shp1234567890123456">
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-1">Partner ID</label>
                    <input type="text" id="shopeePartnerId" class="w-full p-2 border rounded" value="2001234">
                  </div>
                  <button onclick="testShopeeConnection()" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm">
                    Testar Conexão
                  </button>
                </div>
              </div>
            </div>
            
            <div class="mt-6">
              <button onclick="saveApiConfig()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
                Salvar Configurações
              </button>
            </div>
          </div>
          
          <div class="bg-gray-50 p-5 rounded-xl">
            <h3 class="font-semibold text-lg mb-4 pb-2 border-b">Configurações de Backup</h3>
            
            <div class="space-y-4">
              <div class="flex items-center">
                <input type="checkbox" id="autoBackup" class="mr-2" checked>
                <label for="autoBackup">Backup automático diário</label>
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-1">Frequência de Backup</label>
                <select id="backupFrequency" class="border p-2 rounded-lg w-full">
                  <option value="daily">Diário</option>
                  <option value="weekly">Semanal</option>
                  <option value="monthly">Mensal</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-1">Último Backup</label>
                <div class="bg-gray-100 p-3 rounded-lg">
                  <div id="lastBackupInfo" class="text-sm">22/07/2025 03:00</div>
                </div>
              </div>
              
              <div class="flex gap-3">
                <button onclick="createBackup()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                  Criar Backup Agora
                </button>
                <button onclick="restoreBackup()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
                  Restaurar Backup
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="mt-6 bg-gray-50 p-5 rounded-xl">
          <h3 class="font-semibold text-lg mb-4 pb-2 border-b">Gerenciamento de Usuários</h3>
          
          <div class="overflow-x-auto">
            <table class="w-full border-collapse">
              <thead>
                <tr class="bg-gray-100">
                  <th class="p-3 text-left">Nome</th>
                  <th class="p-3 text-left">E-mail</th>
                  <th class="p-3 text-left">Perfil</th>
                  <th class="p-3 text-left">Ações</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <tr class="border-b">
                  <td class="p-3">Administrador</td>
                  <td class="p-3">admin@empresa.com</td>
                  <td class="p-3">
                    <span class="admin-badge profile-badge">
                      admin
                    </span>
                  </td>
                  <td class="p-3">
                    <button class="btn-action btn-edit mr-2">
                      <i class="fas fa-edit"></i>
                    </button>
                  </td>
                </tr>
                <tr class="border-b">
                  <td class="p-3">Operador</td>
                  <td class="p-3">operador@empresa.com</td>
                  <td class="p-3">
                    <span class="operator-badge profile-badge">
                      operador
                    </span>
                  </td>
                  <td class="p-3">
                    <button class="btn-action btn-edit mr-2">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-action btn-delete">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <button onclick="openAddUserModal()" class="mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
            <i class="fas fa-plus mr-2"></i> Adicionar Usuário
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modais -->
  <div id="loginModal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
      <span class="btn-close" onclick="closeModal('loginModal')">&times;</span>
      <h3 class="text-xl font-bold mb-4">Acesso ao Sistema</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1">E-mail</label>
          <input type="email" id="loginEmail" class="w-full p-2 border rounded" value="admin@empresa.com">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Senha</label>
          <input type="password" id="loginPassword" class="w-full p-2 border rounded" value="********">
        </div>
        <button onclick="login()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded">
          <i class="fas fa-sign-in-alt mr-2"></i> Entrar
        </button>
        <div class="text-center">
          <a href="#recover" onclick="openRecoverModal()" class="text-sm text-blue-600">Esqueci minha senha</a>
        </div>
      </div>
    </div>
  </div>

  <div id="recoverModal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
      <span class="btn-close" onclick="closeModal('recoverModal')">&times;</span>
      <h3 class="text-xl font-bold mb-4">Recuperar Senha</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1">E-mail cadastrado</label>
          <input type="email" id="recoverEmail" class="w-full p-2 border rounded" value="admin@empresa.com">
        </div>
        <button onclick="sendRecovery()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded">
          Enviar Link de Recuperação
        </button>
      </div>
    </div>
  </div>

  <div id="addUserModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <span class="btn-close" onclick="closeModal('addUserModal')">&times;</span>
      <h3 class="text-xl font-bold mb-4">Adicionar Novo Usuário</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1">Nome Completo</label>
          <input type="text" id="newUserName" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">E-mail</label>
          <input type="email" id="newUserEmail" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Senha</label>
          <input type="password" id="newUserPassword" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Perfil</label>
          <select id="newUserProfile" class="w-full p-2 border rounded">
            <option value="admin">Administrador</option>
            <option value="operador">Operador</option>
            <option value="visualizador">Visualizador</option>
          </select>
        </div>
        <button onclick="addNewUser()" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded">
          <i class="fas fa-save mr-2"></i> Salvar Usuário
        </button>
      </div>
    </div>
  </div>

  <div id="detalhesModal" class="modal">
    <div class="modal-content">
      <span class="btn-close" onclick="fecharModal()">&times;</span>
      <div id="modalContent"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
    import { 
      getAuth, 
      onAuthStateChanged,
      signInWithEmailAndPassword,
      signOut,
      createUserWithEmailAndPassword,
      sendPasswordResetEmail
    } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js';
    import { 
      getFirestore, 
      doc, 
      getDoc,
      collection,
      getDocs,
      setDoc,
      updateDoc,
      deleteDoc,
      addDoc
    } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyC78l9b2DTNj64y_0fbRKofNupO6NHDmeo",
      authDomain: "matheus-35023.firebaseapp.com",
      projectId: "matheus-35023",
      storageBucket: "matheus-35023.appspot.com",
      messagingSenderId: "1011113149395",
      appId: "1:1011113149395:web:c1f449e0e974ca8ecb2526"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Exportar para o escopo global
    window.firebaseAuth = {
      auth,
      db,
      signInWithEmailAndPassword: (email, password) => signInWithEmailAndPassword(auth, email, password),
      signOut: () => signOut(auth),
      createUserWithEmailAndPassword: (email, password) => createUserWithEmailAndPassword(auth, email, password),
      sendPasswordResetEmail: (email) => sendPasswordResetEmail(auth, email),
      getDoc,
      setDoc,
      updateDoc,
      deleteDoc,
      addDoc,
      collection,
      getDocs,
      doc
    };

    // Monitorar estado de autenticação
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        // Usuário logado
        document.getElementById('currentUser').textContent = user.email;
        document.getElementById('currentUser').classList.remove('hidden');
        document.getElementById('loginBtn').classList.add('hidden');
        document.getElementById('logoutBtn').classList.remove('hidden');
      } else {
        // Usuário não logado
        document.getElementById('currentUser').textContent = '';
        document.getElementById('currentUser').classList.add('hidden');
        document.getElementById('loginBtn').classList.remove('hidden');
        document.getElementById('logoutBtn').classList.add('hidden');
      }
    });
  </script>

  <script type="module">
    // Acessar Firebase do módulo
    const { auth, db } = window.firebaseAuth;
    const { 
      signInWithEmailAndPassword: firebaseSignIn,
      signOut: firebaseSignOut,
      createUserWithEmailAndPassword: firebaseCreateUser,
      sendPasswordResetEmail: firebaseSendPasswordReset,
      getDoc, setDoc, updateDoc, deleteDoc, addDoc, collection, getDocs, doc
    } = window.firebaseAuth;

    // Configuração inicial
    const { jsPDF } = window.jspdf;
    const plataformas = ["ml", "shopee", "magalu", "shein"];
    const camposExtras = [
      "Frete (R$)", "Taxa de Transação (%)", "Taxa de Transferência (%)",
      "Taxa de Antecipação (%)", "Custos Variáveis (R$)", "Imposto (%)", "Comissão do Vendedor (%)"
    ];

    // Dados do sistema
    let sistema = {
      produtos: [],
      historico: [],
      usuarios: [],
      config: {
        backupAuto: true,
        backupFrequency: "daily",
        apiConfig: {
          ml: { clientId: "", clientSecret: "", connected: false },
          shopee: { apiKey: "", partnerId: "", connected: false }
        }
      },
      importedShopeeData: null,
      originalShopeeData: null,
      produtoEditando: null
    };

    // Inicialização
    document.addEventListener('DOMContentLoaded', () => {
      setupCharts();
      setupEventListeners();
      loadSystem();
    });

    // Funções principais do sistema
    async function loadSystem() {
      // Carrega dados iniciais
      sistema.produtos = [
        {
          id: "1",
          produto: "Tênis Esportivo",
          sku: "TN-ESPORT-001",
          plataforma: "SHOPEE",
          precoMinimo: "167.50",
          precoIdeal: "184.25",
          precoMedio: "175.90",
          precoPromo: "167.50",
          custo: "89.90",
          taxas: {
            "Taxas da Plataforma (%)": "14",
            "Custo Fixo Plataforma (R$)": "4",
            "Frete (R$)": "12.00",
            "Taxa de Transação (%)": "3.5",
            "Taxa de Transferência (%)": "1.0",
            "Taxa de Antecipação (%)": "1.5",
            "Custos Variáveis (R$)": "4.00",
            "Imposto (%)": "10.0",
            "Comissão do Vendedor (%)": "2.5"
          },
          createdAt: new Date().toISOString()
        },
        {
          id: "2",
          produto: "Camiseta Premium",
          sku: "CM-PREM-002",
          plataforma: "ML",
          precoMinimo: "73.50",
          precoIdeal: "80.85",
          precoMedio: "77.18",
          precoPromo: "73.50",
          custo: "35.00",
          taxas: {
            "Taxas da Plataforma (%)": "16",
            "Custo Fixo Plataforma (R$)": "6",
            "Frete (R$)": "8.00",
            "Taxa de Transação (%)": "3.0",
            "Taxa de Transferência (%)": "1.0",
            "Taxa de Antecipação (%)": "1.8",
            "Custos Variáveis (R$)": "3.00",
            "Imposto (%)": "8.0",
            "Comissão do Vendedor (%)": "2.0"
          },
          createdAt: new Date().toISOString()
        }
      ];
      
      sistema.usuarios = [
        {
          id: "1",
          email: "admin@empresa.com",
          nome: "Administrador",
          perfil: "admin",
          permissoes: ["todos"]
        },
        {
          id: "2",
          email: "operador@empresa.com",
          nome: "Operador",
          perfil: "operador",
          permissoes: ["editar", "exportar"]
        }
      ];
      
      sistema.historico = [
        {
          id: "1",
          action: "product_update",
          description: "Produto 'Tênis Esportivo' atualizado",
          user: "admin@empresa.com",
          timestamp: new Date().toISOString()
        },
        {
          id: "2",
          action: "login",
          description: "Usuário admin@empresa.com fez login",
          user: "admin@empresa.com",
          timestamp: new Date().toISOString()
        }
      ];
      
      atualizarLista();
      updateKPIs();
    }

    // Funções de autenticação
    async function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      try {
        await firebaseSignIn(email, password);
        closeModal('loginModal');
        
        // Mostrar feedback visual
        const feedback = document.createElement('div');
        feedback.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg';
        feedback.innerHTML = `<i class="fas fa-check-circle mr-2"></i> Login realizado com sucesso!`;
        document.body.appendChild(feedback);
        
        setTimeout(() => {
          feedback.remove();
        }, 3000);
        
      } catch (error) {
        alert('Credenciais inválidas! ' + error.message);
      }
    }

    async function logout() {
      try {
        await firebaseSignOut();
        
        // Mostrar feedback visual
        const feedback = document.createElement('div');
        feedback.className = 'fixed bottom-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg';
        feedback.innerHTML = `<i class="fas fa-sign-out-alt mr-2"></i> Logout realizado com sucesso!`;
        document.body.appendChild(feedback);
        
        setTimeout(() => {
          feedback.remove();
        }, 3000);
        
      } catch (error) {
        console.error("Erro ao fazer logout: ", error);
      }
    }

    async function sendRecovery() {
      const email = document.getElementById('recoverEmail').value;
      try {
        await firebaseSendPasswordReset(email);
        alert(`Link de recuperação enviado para ${email}`);
        closeModal('recoverModal');
      } catch (error) {
        alert('Erro ao enviar email de recuperação: ' + error.message);
      }
    }

    // Funções de precificação
    function calcular(plataforma) {
      const custo = parseFloat(document.getElementById("custo").value) || 0;
      const produto = document.getElementById("produto").value.trim();
      const sku = document.getElementById("sku").value.trim();
      
      if (!produto || custo <= 0) {
        alert("Preencha o nome do produto e um custo válido!");
        return;
      }

      let totalPercentual = 0;
      let totalFixo = 0;
      const taxasDetalhadas = {};

      // Taxa da Plataforma
      const taxaSelect = document.getElementById(`${plataforma}_taxa_select`);
      const taxaInput = document.getElementById(`${plataforma}_taxa_custom`);
      const taxa = taxaInput.value.trim() !== '' ? 
                   parseFloat(taxaInput.value) : 
                   parseFloat(taxaSelect.value) || 0;
      totalPercentual += taxa;
      taxasDetalhadas['Taxas da Plataforma (%)'] = taxa;

      // Custo Fixo
      const fixoSelect = document.getElementById(`${plataforma}_fixo_select`);
      const fixoInput = document.getElementById(`${plataforma}_fixo_custom`);
      const fixo = fixoInput.value.trim() !== '' ? 
                   parseFloat(fixoInput.value) : 
                   parseFloat(fixoSelect.value) || 0;
      totalFixo += fixo;
      taxasDetalhadas['Custo Fixo Plataforma (R$)'] = fixo;

      // Demais campos
      const container = document.getElementById(`${plataforma}Campos`);
      const inputs = container.querySelectorAll('input[data-campo]');
      inputs.forEach(input => {
        const valor = parseFloat(input.value) || 0;
        const campo = input.getAttribute('data-campo');
        const isPercentual = input.placeholder.includes('%');
        if (isPercentual) {
          totalPercentual += valor;
        } else {
          totalFixo += valor;
        }
        taxasDetalhadas[campo] = valor;
      });

      // Verificação de valores
      if (totalPercentual >= 100) {
        alert("As taxas percentuais não podem somar 100% ou mais!");
        return;
      }

      // Calcular preço mínimo (sem lucro)
      const precoMinimo = ((custo + totalFixo) / (1 - totalPercentual / 100)).toFixed(2);
      document.getElementById(`preco_${plataforma}`).value = precoMinimo;
      
      // Calcular cenários de lucro
      const precoPromo = precoMinimo; // 0% de lucro
      const precoMedio = (precoMinimo * 1.05).toFixed(2); // 5% de lucro
      const precoIdeal = (precoMinimo * 1.10).toFixed(2); // 10% de lucro
      
      document.getElementById(`preco_${plataforma}_ideal`).textContent = `R$ ${precoIdeal}`;
      document.getElementById(`preco_${plataforma}_medio`).textContent = `R$ ${precoMedio}`;
      document.getElementById(`preco_${plataforma}_promo`).textContent = `R$ ${precoPromo}`;

      // Salvar produto
      salvarProduto(produto, sku, plataforma.toUpperCase(), precoMinimo, precoIdeal, precoMedio, precoPromo, custo, taxasDetalhadas);
    }
 // Disponibiliza a função no escopo global para uso em atributos inline
    window.calcular = calcular;

    async function salvarProduto(produto, sku, plataforma, precoMinimo, precoIdeal, precoMedio, precoPromo, custo, taxas) {
      // Simulação de salvamento
      const novoProduto = {
        produto,
        sku,
        plataforma, 
        precoMinimo,
        precoIdeal,
        precoMedio,
        precoPromo,
        custo,
        taxas,
        createdAt: new Date().toISOString()
      };

      // Adicionar à lista
      sistema.produtos.push(novoProduto);
      atualizarLista();
      
      // Mostrar feedback visual
      const feedback = document.createElement('div');
      feedback.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg';
      feedback.innerHTML = `<i class="fas fa-check-circle mr-2"></i> Produto salvo com sucesso!`;
      document.body.appendChild(feedback);
      
      setTimeout(() => {
        feedback.remove();
      }, 3000);
    }

    function atualizarLista() {
      const filtro = document.getElementById("filtroPlataforma").value;
      const container = document.getElementById("listaProdutos");
      
      container.innerHTML = "";
      
      const listaFiltrada = filtro === "Todas" ? 
          sistema.produtos : 
          sistema.produtos.filter(item => item.plataforma === filtro);
      
      if (listaFiltrada.length === 0) {
        container.innerHTML = `
          <div class="col-span-2 text-center py-10">
            <i class="fas fa-box-open text-5xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-medium text-gray-500">Nenhum produto encontrado</h3>
            <p class="text-gray-400">Adicione produtos na aba de Precificação</p>
          </div>
        `;
        return;
      }
      
      listaFiltrada.forEach(item => {
        const div = document.createElement("div");
        div.className = "product-card";
        
        // Determinar classe de cor para a plataforma
        let platformClass = "";
        let platformName = "";
        switch(item.plataforma) {
          case "ML":
            platformClass = "platform-ml";
            platformName = "Mercado Livre";
            break;
          case "SHOPEE":
            platformClass = "platform-shopee";
            platformName = "Shopee";
            break;
          case "MAGALU":
            platformClass = "platform-magalu";
            platformName = "Magalu";
            break;
          case "SHEIN":
            platformClass = "platform-shein";
            platformName = "SHEIN";
            break;
        }
        
        div.innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <h3 class="font-bold text-lg">${item.produto}</h3>
              ${item.sku ? `<div class="text-sm text-gray-500">SKU: ${item.sku}</div>` : ''}
              <div class="mt-1">
                <span class="${platformClass} platform-tag">${platformName}</span>
              </div>
            </div>
            <div class="text-right">
              <div class="text-gray-500 text-sm">Preço mínimo</div>
              <div class="product-price text-green-600">R$ ${parseFloat(item.precoMinimo).toFixed(2)}</div>
            </div>
          </div>
          
          <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between">
            <div class="text-sm text-gray-500">
              <i class="far fa-calendar-alt"></i> ${new Date(item.createdAt).toLocaleDateString('pt-BR')}
            </div>
            <div class="flex space-x-2">
              <button onclick="verDetalhes()" class="btn-action btn-view">
                <i class="fas fa-eye"></i> Ver
              </button>
              <button onclick="editarProduto()" class="btn-action btn-edit">
                <i class="fas fa-edit"></i> Editar
              </button>
              <button class="btn-action btn-delete">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        `;
        container.appendChild(div);
      });
      
      // Atualiza KPIs
      updateKPIs();
    }

    function verDetalhes() {
      const html = `
        <h3 class="text-2xl font-bold mb-2">Tênis Esportivo</h3>
        <div class="text-gray-600 mb-2">SKU: TN-ESPORT-001</div>
        <div class="flex items-center mb-6">
          <span class="platform-shopee platform-tag mr-3">Shopee</span>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div class="scenario-card scenario-promo">
            <div class="scenario-title">Sem Lucro (0%)</div>
            <div class="scenario-value">R$ 167.50</div>
          </div>
          
          <div class="scenario-card scenario-medium">
              <div class="scenario-title">Lucro 5%</div>
            <div class="scenario-value">R$ 175.90</div>
          </div>
          
          <div class="scenario-card scenario-ideal">
            <div class="scenario-title">Lucro 10%</div>
            <div class="scenario-value">R$ 184.25</div>
          </div>
          
          <div class="bg-gray-100 p-4 rounded-lg">
            <div class="font-semibold">Preço Mínimo</div>
            <div class="text-xl font-bold text-green-600">R$ 167.50</div>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="bg-gray-50 p-5 rounded-xl">
            <h4 class="font-semibold text-lg mb-4 pb-2 border-b">Informações Básicas</h4>
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-gray-600">Custo do produto:</span>
                <span class="font-medium">R$ 89.90</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Data de cadastro:</span>
                <span class="font-medium">22/07/2025</span>
              </div>
            </div>
          </div>
          
          <div class="bg-gray-50 p-5 rounded-xl">
            <h4 class="font-semibold text-lg mb-4 pb-2 border-b">Detalhes das Taxas</h4>
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-gray-600">Taxas da Plataforma (%):</span>
                <span class="font-medium">14 %</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Custo Fixo Plataforma (R$):</span>
                <span class="font-medium">4.00 R$</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Frete (R$):</span>
                <span class="font-medium">12.00 R$</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Taxa de Transação (%):</span>
                <span class="font-medium">3.5 %</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Taxa de Transferência (%):</span>
                <span class="font-medium">1.0 %</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Taxa de Antecipação (%):</span>
                <span class="font-medium">1.5 %</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Custos Variáveis (R$):</span>
                <span class="font-medium">4.00 R$</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Imposto (%):</span>
                <span class="font-medium">10.0 %</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Comissão do Vendedor (%):</span>
                <span class="font-medium">2.5 %</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="mt-8 text-right">
          <button onclick="fecharModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-5 py-2 rounded-lg font-medium">
            Fechar
          </button>
        </div>
      `;
      
      document.getElementById("modalContent").innerHTML = html;
      document.getElementById("detalhesModal").style.display = "block";
    }

    function fecharModal() {
      document.getElementById("detalhesModal").style.display = "none";
    }

    function editarProduto() {
      // Preencher campos básicos
      document.getElementById("produto").value = "Tênis Esportivo";
      document.getElementById("sku").value = "TN-ESPORT-001";
      document.getElementById("custo").value = "89.90";
      
      // Ativar aba de precificação
      document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
      document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
      document.querySelector(`.tab-button[data-tab="precificacao"]`).classList.add("active");
      document.getElementById('precificacao').classList.add("active");
      
      // Rolar para o topo
      window.scrollTo(0, 0);
    }

    function exportarExcel() {
      // Simulação de exportação
      alert("Exportação para Excel realizada com sucesso!");
    }

    function exportarPDF() {
      // Simulação de exportação
      alert("Exportação para PDF realizada com sucesso!");
    }

    function importShopeeFile() {
      // Simulação de importação
      const feedback = document.createElement('div');
      feedback.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg';
      feedback.innerHTML = `<i class="fas fa-check-circle mr-2"></i> Planilha Shopee importada com sucesso!`;
      document.body.appendChild(feedback);
      
      setTimeout(() => {
        feedback.remove();
      }, 3000);
    }

    function applyPriceUpdate(type) {
      const prices = {
        'promo': 'Sem Lucro (0%)',
        'medium': 'Lucro 5%',
        'ideal': 'Lucro 10%'
      };
      
      alert(`Preços atualizados com cenário de ${prices[type]}`);
    }

    function exportShopeeFile() {
      // Simulação de exportação
      alert("Planilha Shopee exportada com sucesso!");
    }

    // Funções auxiliares
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'block';
    }

    function openRecoverModal() {
      closeModal('loginModal');
      openModal('recoverModal');
    }

    function openAddUserModal() {
      openModal('addUserModal');
    }

    function setupCharts() {
      // Gráfico de margens
      const marginCtx = document.getElementById('marginChart').getContext('2d');
      new Chart(marginCtx, {
        type: 'bar',
        data: {
          labels: ['Mercado Livre', 'Shopee', 'Magalu', 'SHEIN'],
          datasets: [{
            label: 'Margem Média (%)',
            data: [22, 18, 15, 20],
            backgroundColor: [
              '#FF6384',
              '#36A2EB',
              '#FFCE56',
              '#4BC0C0'
            ]
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      // Gráfico de produtos mais rentáveis
      const topProductsCtx = document.getElementById('topProductsChart').getContext('2d');
      new Chart(topProductsCtx, {
        type: 'doughnut',
        data: {
          labels: ['Tênis Esportivo', 'Camiseta Premium', 'Calça Jeans', 'Bolsa Feminina', 'Relógio'],
          datasets: [{
            data: [35, 25, 20, 15, 5],
            backgroundColor: [
              '#FF6384',
              '#36A2EB',
              '#FFCE56',
              '#4BC0C0',
              '#9966FF'
            ]
          }]
        },
        options: {
          responsive: true
        }
      });

      // Gráfico de histórico de preços
      const priceCtx = document.getElementById('priceHistoryChart').getContext('2d');
      new Chart(priceCtx, {
        type: 'line',
        data: {
          labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
          datasets: [
            {
              label: 'Preço Mínimo',
              data: [89, 92, 95, 94, 96, 98],
              borderColor: '#F44336',
              fill: false
            },
            {
              label: 'Preço Ideal',
              data: [120, 122, 125, 124, 126, 128],
              borderColor: '#4CAF50',
              fill: false
            }
          ]
        },
        options: {
          responsive: true
        }
      });
    }

    function setupEventListeners() {
      // Login/logout
      document.getElementById('loginBtn').addEventListener('click', () => openModal('loginModal'));
      document.getElementById('logoutBtn').addEventListener('click', logout);
      
      // Tabs
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          btn.classList.add('active');
          document.getElementById(btn.dataset.tab).classList.add('active');
        });
      });
      
      // Filtros
      document.getElementById('filtroPlataforma').addEventListener('change', atualizarLista);
    }

    function updateKPIs() {
      document.getElementById('totalProducts').textContent = sistema.produtos.length;
    }

    function testMlConnection() {
      alert('Conexão com Mercado Livre testada com sucesso!');
    }

    function testShopeeConnection() {
      alert('Conexão com Shopee testada com sucesso!');
    }

    function saveApiConfig() {
      alert('Configurações de API salvas com sucesso!');
    }

    function createBackup() {
      alert('Backup criado com sucesso!');
    }

    function restoreBackup() {
      alert('Backup restaurado com sucesso!');
    }

    function addNewUser() {
      alert('Usuário adicionado com sucesso!');
      closeModal('addUserModal');
    }
  </script>
</body>
</html>
